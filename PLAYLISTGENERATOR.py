import streamlit as st
from huggingface_hub import InferenceClient
import requests
import random
import urllib.parse

# --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ ---
DEFAULT_HF_TOKEN = os.getenv('HF_TOKEN')
MODEL_REPO_ID = "Qwen/Qwen2.5-72B-Instruct"

# --- BACKEND: –°–ï–†–í–ò–° –ü–û–õ–£–ß–ï–ù–ò–Ø –î–ê–ù–ù–´–• ---
def fetch_artist_metadata(artist_name: str) -> dict | None:
    """
    –ü–æ–ª—É—á–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞—Ä—Ç–∏—Å—Ç–∞, —Ç–æ–ø-—Ç—Ä–µ–∫–∏ –∏ —Å–ø–∏—Å–æ–∫ –ø–æ—Ö–æ–∂–∏—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ API Deezer.
    –†–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫—É—é (—Å–ª—É—á–∞–π–Ω—É—é) –≤—ã–±–æ—Ä–∫—É –∏–∑ –ø—É–ª–∞ –ø–æ—Ö–æ–∂–∏—Ö –∞—Ä—Ç–∏—Å—Ç–æ–≤ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
    """
    try:
        # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ ID –∞—Ä—Ç–∏—Å—Ç–∞ –∏ –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        search_url = f"https://api.deezer.com/search/artist?q={artist_name}"
        response = requests.get(search_url).json()
        
        if not response.get('data'):
            return None
            
        artist_obj = response['data'][0]
        artist_id = artist_obj['id']
        real_name = artist_obj['name']
        
        # 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø-—Ç—Ä–µ–∫–æ–≤ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
        tracks_url = f"https://api.deezer.com/artist/{artist_id}/top?limit=4"
        tracks_data = requests.get(tracks_url).json().get('data', [])
        source_tracks = [t['title'] for t in tracks_data]
        
        # 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É–ª–∞ –ø–æ—Ö–æ–∂–∏—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π (–õ–∏–º–∏—Ç 20 –¥–ª—è –≤—ã–±–æ—Ä–∫–∏)
        related_url = f"https://api.deezer.com/artist/{artist_id}/related?limit=20"
        related_data_all = requests.get(related_url).json().get('data', [])
        
        # –í—ã–±–æ—Ä–∫–∞ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞ (Random Sampling)
        if len(related_data_all) > 5:
            related_data = random.sample(related_data_all, 5)
        else:
            related_data = related_data_all
        
        similar_artists_info = []
        for rel_artist in related_data:
            # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø-—Ç—Ä–µ–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∞—Ä—Ç–∏—Å—Ç–∞
            r_id = rel_artist['id']
            r_tracks_url = f"https://api.deezer.com/artist/{r_id}/top?limit=2"
            r_tracks_data = requests.get(r_tracks_url).json().get('data', [])
            r_tracks = [t['title'] for t in r_tracks_data]
            
            similar_artists_info.append({
                "name": rel_artist['name'],
                "tracks": r_tracks
            })
            
        return {
            "source_artist": real_name,
            "source_tracks": source_tracks,
            "similar": similar_artists_info
        }
    except Exception as e:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ (–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥-—Ñ–∞–π–ª)
        print(f"API Error: {e}")
        return None

# --- –ö–õ–ê–°–° –ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–¨–ù–û–ì–û –ê–ì–ï–ù–¢–ê ---
class Agent:
    """
    –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –±–∞–∑–µ LLM —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Ä–æ–ª—å—é –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    """
    def __init__(self, name: str, role: str, client: InferenceClient):
        self.name = name
        self.role = role
        self.client = client

    def execute(self, input_context: str) -> str:
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∫ Inference API."""
        messages = [
            {
                "role": "system", 
                "content": f"""
                –†–û–õ–¨: {self.name}
                –ó–ê–î–ê–ß–ê: {self.role}
                –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
                1. –Ø–∑—ã–∫ –≤—ã–≤–æ–¥–∞: –†—É—Å—Å–∫–∏–π.
                2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Markdown —Ä–∞–∑–º–µ—Ç–∫—É.
                3. –°—Ç—Ä–æ–≥–æ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∞–Ω–Ω—ã—Ö.
                """
            },
            {
                "role": "user", 
                "content": f"–ö–û–ù–¢–ï–ö–°–¢ –î–ê–ù–ù–´–•:\n{input_context}"
            }
        ]
        try:
            response = self.client.chat_completion(
                messages=messages, 
                max_tokens=1500, 
                temperature=0.4, # –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å—é
                top_p=0.9
            )
            return response.choices[0].message.content
        except Exception as e:
            return f"–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞: {e}"

# --- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –ò–ù–¢–ï–†–§–ï–ô–° (STREAMLIT) ---
def main():
    st.set_page_config(page_title="–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ú–ê–°", page_icon="üéµ", layout="wide")
    
    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    st.title("üéµ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –°–∏—Å—Ç–µ–º–∞ –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ü–ª–µ–π–ª–∏—Å—Ç–æ–≤")
    st.markdown("### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –ú—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã")
    st.markdown("**–í—ã–ø–æ–ª–Ω–∏–ª–∏:** –ì—Ä—É–¥–Ω–∏—Ü–∫–∏–π –∏ –°–æ–ª–æ–≤—å—ë–≤")
    st.markdown("---")

    # –°–∞–π–¥–±–∞—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    with st.sidebar:
        st.header("–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –°–∏—Å—Ç–µ–º—ã")
        hf_token = st.text_input("–¢–æ–∫–µ–Ω Hugging Face API", value=DEFAULT_HF_TOKEN, type="password")
        if not hf_token:
            st.warning("–û–∂–∏–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
            return

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
    client = InferenceClient(model=MODEL_REPO_ID, token=hf_token)

    # –ë–ª–æ–∫ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
    col1, col2 = st.columns([3, 1])
    with col1:
        user_query = st.text_input("–í–≤–æ–¥ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è / –†–µ—Ñ–µ—Ä–µ–Ω—Å", "Linkin Park")
    with col2:
        st.write("")
        st.write("")
        run_btn = st.button("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ê–≥–µ–Ω—Ç–æ–≤", type="primary")

    if run_btn and user_query:
        
        # --- –≠–¢–ê–ü 0: –°–ë–û–† –î–ê–ù–ù–´–• (DATA ACQUISITION) ---
        raw_data = None
        with st.status("–°–∏—Å—Ç–µ–º–∞: –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ API...", expanded=True) as status:
            raw_data = fetch_artist_metadata(user_query)
            if raw_data:
                st.success(f"–¶–µ–ª–µ–≤–æ–π –æ–±—ä–µ–∫—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω: {raw_data['source_artist']}. –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –ø–æ–ª—É—á–µ–Ω—ã.")
                status.update(label="–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω", state="complete")
            else:
                status.update(label="–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö", state="error")
                st.error("–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.")
                st.stop()

        # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
        context_payload = f"–¶–ï–õ–ï–í–ê–Ø –°–£–©–ù–û–°–¢–¨: {raw_data['source_artist']} (–¢–æ–ø-—Ç—Ä–µ–∫–∏: {', '.join(raw_data['source_tracks'])})\n"
        context_payload += "–°–í–Ø–ó–ê–ù–ù–´–ï –°–£–©–ù–û–°–¢–ò:\n"
        for s in raw_data['similar']:
            context_payload += f"- {s['name']} (–¢—Ä–µ–∫–∏: {', '.join(s['tracks'])})\n"

        st.divider()

        # --- –≠–¢–ê–ü 1: –°–ï–ú–ê–ù–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó ---
        st.subheader("üïµÔ∏è –ê–≥–µ–Ω—Ç 1: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ê–Ω–∞–ª–∏–∑")
        agent1 = Agent(
            name="–ê–≥–µ–Ω—Ç 1 (–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –°—Ö–æ–¥—Å—Ç–≤–∞)",
            role="–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π. –û–±—ä—è—Å–Ω–∏ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏ –∂–∞–Ω—Ä–æ–≤—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ü–µ–ª–µ–≤—ã–º –∞—Ä—Ç–∏—Å—Ç–æ–º –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏.",
            client=client
        )
        with st.chat_message("assistant", avatar="üïµÔ∏è"):
            with st.spinner("–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞..."):
                output_1 = agent1.execute(context_payload)
                st.markdown(output_1)

        # --- –≠–¢–ê–ü 2: –ê–ì–†–ï–ì–ê–¶–ò–Ø –ü–õ–ï–ô–õ–ò–°–¢–ê ---
        st.subheader("üíø –ê–≥–µ–Ω—Ç 2: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ü–ª–µ–π–ª–∏—Å—Ç–∞")
        agent2 = Agent(
            name="–ê–≥–µ–Ω—Ç 2 (–ö–æ–º–ø–æ–∑–∏—Ç–æ—Ä –ü–ª–µ–π–ª–∏—Å—Ç–∞)",
            role="""
            –°—Ñ–æ—Ä–º–∏—Ä—É–π –µ–¥–∏–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
            –í–∫–ª—é—á–∏ —Ç—Ä–µ–∫–∏ –∫–∞–∫ —Ü–µ–ª–µ–≤–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, —Ç–∞–∫ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
            –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞: '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å - –ù–∞–∑–≤–∞–Ω–∏–µ –¢—Ä–µ–∫–∞'.
            –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã.
            """,
            client=client
        )
        with st.chat_message("assistant", avatar="üíø"):
            with st.spinner("–ö–æ–º–ø–∏–ª—è—Ü–∏—è —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–∫–æ–≤..."):
                output_2 = agent2.execute(context_payload)
                st.markdown(output_2)

        # --- –≠–¢–ê–ü 3: –ö–õ–ê–°–¢–ï–†–ò–ó–ê–¶–ò–Ø –ò –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ---
        st.subheader("üìä –ê–≥–µ–Ω—Ç 3: –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏—é")
        agent3 = Agent(
            name="–ê–≥–µ–Ω—Ç 3 (–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä)",
            role="""
            –í—ã–ø–æ–ª–Ω–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–∫–æ–≤.
            1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞—É–¥–∏–æ-—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ–º—ã–µ –∂–∞–Ω—Ä–æ–º).
            2. –†–∞–∑–¥–µ–ª–∏ —Å–ø–∏—Å–æ–∫ –Ω–∞ –¥–≤–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–í—ã—Å–æ–∫–∞—è –≠–Ω–µ—Ä–≥–∏—è' vs '–ú–µ–ª–æ–¥–∏—á–Ω–æ–µ/–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ').
            3. –í—ã–≤–µ–¥–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –ø–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.
            """,
            client=client
        )
        with st.chat_message("assistant", avatar="üìä"):
            with st.spinner("–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∞—É–¥–∏–æ-–ø—Ä–∏–∑–Ω–∞–∫–æ–≤..."):
                output_3 = agent3.execute(output_2)
                st.markdown(output_3)

        # --- –≠–¢–ê–ü 4: –ú–ï–•–ê–ù–ò–ó–ú –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ô ---
        st.subheader("üü¢ –ê–≥–µ–Ω—Ç 4: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è –°–∏—Å—Ç–µ–º–∞")
        agent4 = Agent(
            name="–ê–≥–µ–Ω—Ç 4 (Discovery Engine)",
            role="""
            –ó–∞–¥–∞—á–∞ 1: –°–∏–º—É–ª—è—Ü–∏—è –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
            –ü—Ä–µ–¥–ª–æ–∂–∏ 3 –ù–û–í–´–• —Ç—Ä–µ–∫–∞ –æ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π, –ù–ï –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–ø–∏—Å–∫–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –≤—ã—è–≤–ª–µ–Ω–Ω—ã–º –∂–∞–Ω—Ä–∞–º.
            
            –ó–∞–¥–∞—á–∞ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –í–Ω–µ—à–Ω–∏–º–∏ –°–µ—Ä–≤–∏—Å–∞–º–∏ (Spotify).
            –ü—Ä–µ–¥–ª–æ–∂–∏ 3 –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —ç—Ç–æ–º—É –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é.
            –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –≤–∞–ª–∏–¥–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–∏—Å–∫ (Search URL).
            
            –§–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏: `[–ù–∞–∑–≤–∞–Ω–∏–µ –ü–ª–µ–π–ª–∏—Å—Ç–∞](https://open.spotify.com/search/–ó–ê–ü–†–û–°)`
            (–ó–∞–º–µ–Ω–∏ –ó–ê–ü–†–û–° –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞ –∏–ª–∏ –∂–∞–Ω—Ä–∞).
            """,
            client=client
        )
        with st.chat_message("assistant", avatar="üü¢"):
            with st.spinner("–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏ —Å—Å—ã–ª–æ–∫..."):
                output_4 = agent4.execute(output_3)
                st.success("–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ú–∏–∫—Å—ã –∏ Discovery:")
                st.markdown(output_4)

if __name__ == "__main__":
    main()